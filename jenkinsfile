pipeline {
    agent { label 'slave01' }

    environment {
        IMAGE_NAME = "hubdc.dso.local/gungun/python-prisma:20250604"
        CX_TOKEN   = credentials('cx_token')
    }

    stages {
        stage('Checkout Code') {
            steps {
                checkout scm
            }
        }

        stage('Build Docker Image') {
            steps {
                sh "docker build -t ${IMAGE_NAME} ."
            }
        }

        stage('Run Python Script in Container') {
            steps {
                script {
                    docker.image("${IMAGE_NAME}").inside("-u 1002:1002 -v \$WORKSPACE:/app:Z -w /app") {
                        sh '''
                            python3 cxone_end_to_end.py \
                              --project-name "MFEC_end_to_end_scan" \
                              --tenant "nfr_westconth" \
                              --token "${CX_TOKEN}" \
                              --region "anz" \
                              --scan-id "e3d1cb0e-440e-4f15-aace-4167b9be8232"
                        '''
                    }
                }
            }
        }
    }
}
